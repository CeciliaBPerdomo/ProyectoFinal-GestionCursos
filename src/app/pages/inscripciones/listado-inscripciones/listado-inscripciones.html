<div class="inscripcion-form-container">
  <div class="d-flex justify-content-between align-items-center mb-4">
    <div class="curso-header">
      <div class="header-content">
        <div class="title-group">
          <h2 class="curso-title">
            <mat-icon class="title-icon">groups</mat-icon>
            Listado de inscripciones
          </h2>
          <p class="curso-subtitle">
            Consulta, edita o elimina inscripciones del sistema
          </p>
        </div>

        <button mat-raised-button color="primary" (click)="volverAlDashboard()" class="back-dashboard-btn">
          <mat-icon>dashboard</mat-icon>
          Volver al Dashboard
        </button>
      </div>
    </div>
  </div>

  <!-- Acciones sobre la tabla -->
  <div class="header-actions-bot">
    <button mat-raised-button color="accent" routerLink="/inscripciones/alta">
      <mat-icon>person_add</mat-icon>
      Nueva inscripción
    </button>
    <button mat-icon-button color="primary" (click)="refrescar()" matTooltip="Actualizar listado">
      <mat-icon>refresh</mat-icon>
    </button>
  </div>

  <!-- Loading spinner -->
  <div *ngIf="loading$ | async" class="text-center py-4">
    <mat-spinner diameter="40"></mat-spinner>
    <p class="mt-2">Cargando inscripciones...</p>
  </div>

  <!-- Error message -->
  <div *ngIf="error$ | async as error" class="alert alert-danger">
    {{ error }}
  </div>

  <!-- Filtros -->
  <!-- <div class="row mb-3" *ngIf="!(loading$ | async)">
    <div class="col-md-4">
      <mat-form-field appearance="outline" class="w-100">
        <mat-label>Filtrar por estado</mat-label>
        <mat-select (selectionChange)="filtrarPorEstado($event.value)">
          <mat-option value="todos">Todos los estados</mat-option>
          <mat-option value="activa">Activas</mat-option>
          <mat-option value="cancelada">Canceladas</mat-option>
          <mat-option value="finalizada">Finalizadas</mat-option>
          <mat-option value="sin">Sin inscripción</mat-option>
        </mat-select>
      </mat-form-field>
    </div>
  </div> -->

  <!-- Table -->
  <div class="table-responsive tabla-contenedor" *ngIf="!(loading$ | async)">
    <table mat-table [dataSource]="(inscripcionesCompletas$ | async) ?? []" class="mat-elevation-z8 alumno-table">

      <!-- ID -->
      <ng-container matColumnDef="id">
        <th mat-header-cell *matHeaderCellDef> ID </th>
        <td mat-cell *matCellDef="let inscripcion">
          {{ inscripcion.inscrId || inscripcion.id }}
        </td>
      </ng-container>

      <!-- Alumno -->
      <ng-container matColumnDef="alumno">
        <th mat-header-cell *matHeaderCellDef> Alumno </th>
        <td mat-cell *matCellDef="let inscripcion">
          {{ inscripcion.alumnoNombre }}
        </td>
      </ng-container>

      <!-- Curso -->
      <ng-container matColumnDef="curso">
        <th mat-header-cell *matHeaderCellDef> Curso </th>
        <td mat-cell *matCellDef="let inscripcion">
          {{ inscripcion.cursoNombre }}
        </td>
      </ng-container>

      <!-- Fecha -->
      <ng-container matColumnDef="fecha">
        <th mat-header-cell *matHeaderCellDef> Fecha </th>
        <td mat-cell *matCellDef="let inscripcion">
          {{ inscripcion.fechaInsc | date:'dd/MM/yyyy' }}
        </td>
      </ng-container>

      <!-- Estado -->
      <ng-container matColumnDef="estado">
        <th mat-header-cell *matHeaderCellDef> Estado </th>
        <td mat-cell *matCellDef="let inscripcion">
          <ng-container *ngIf="estadoEditandoId === (inscripcion.inscrId || inscripcion.id); else mostrarEstado">
            <mat-form-field appearance="fill">
              <mat-select [(ngModel)]="estadoSeleccionado">
                <mat-option *ngFor="let estado of estados" [value]="estado">
                  {{ mostrarEstadoNormalizado(estado) }}
                </mat-option>
              </mat-select>
            </mat-form-field>
            <button mat-icon-button color="primary"
              (click)="guardarEstado(inscripcion.inscrId || inscripcion.id, inscripcion)">
              <mat-icon>check</mat-icon>
            </button>
            <button mat-icon-button color="warn" (click)="cancelarEdicion()">
              <mat-icon>close</mat-icon>
            </button>
          </ng-container>
          <ng-template #mostrarEstado>
            <span [ngClass]="{
            'text-success': inscripcion.estado === 'activa',
            'text-danger': inscripcion.estado === 'cancelada',
            'text-warning': inscripcion.estado === 'finalizada',
            'text-muted': esEstadoSinInscripcion(inscripcion.estado)
          }">
              {{ mostrarEstadoNormalizado(inscripcion.estado) }}
            </span>
          </ng-template>
        </td>
      </ng-container>

      <!-- Acciones -->
      <ng-container matColumnDef="acciones">
        <th mat-header-cell *matHeaderCellDef> Acciones </th>
        <td mat-cell *matCellDef="let inscripcion">
          <ng-container *ngIf="!esEstadoSinInscripcion(inscripcion.estado)">
            <!-- <button mat-icon-button color="accent"
              (click)="editarEstado(inscripcion.inscrId || inscripcion.id, inscripcion.estado)"
              *ngIf="estadoEditandoId !== (inscripcion.inscrId || inscripcion.id)">
              <mat-icon>edit</mat-icon>
            </button> -->
            <button mat-icon-button class="text-danger" (click)="mostrarModalEliminar(inscripcion.inscrId || inscripcion.id)">
              <mat-icon>delete</mat-icon>
            </button>
          </ng-container>
          <ng-container *ngIf="esEstadoSinInscripcion(inscripcion.estado)">
            <button mat-raised-button color="primary"
              (click)="editarEstado(inscripcion.inscrId || inscripcion.id, 'activa')">
              Crear Inscripción
            </button>
          </ng-container>
        </td>
      </ng-container>

      <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
      <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
    </table>
  </div>

  <!-- Empty state -->
  <div *ngIf="(inscripcionesCompletas$ | async)?.length === 0 && !(loading$ | async) && !(error$ | async)"
    class="text-center py-5">
    <mat-icon class="empty-icon">assignment</mat-icon>
    <h4>No hay inscripciones registradas</h4>
    <p>No se encontraron inscripciones en el sistema.</p>
  </div>
</div>

<!-- Modal de confirmación -->
<div class="modal fade" id="confirmDeleteModal" tabindex="-1" aria-labelledby="modalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content shadow">
      <div class="modal-header bg-danger text-white">
        <h5 class="modal-title" id="modalLabel">Confirmar eliminación</h5>
        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Cerrar"></button>
      </div>
      <div class="modal-body">
        ¿Estás seguro que querés eliminar esta inscripción? Esta acción no se puede deshacer.
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
        <button id="confirmDeleteBtn" type="button" class="btn btn-danger">Eliminar</button>
      </div>
    </div>
  </div>
</div>